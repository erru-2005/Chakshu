<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Dashboard - {{ student.studentName }}</title>
    <script src="{{ url_for('static', filename='js/tailwindcss.js') }}"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            scroll-behavior: smooth;
        }
        body {
            background: #ffffff;
            min-height: 100vh;
        }
        .section-divider {
            height: 1px;
            background: linear-gradient(to right, transparent, #d1d5db, transparent);
            margin: 3rem 0;
        }
        .nav-menu {
            position: fixed;
            left: 0;
            top: 0;
            height: 100vh;
            width: 80px;
            background: #f9fafb;
            border-right: 1px solid #e5e7eb;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 1rem 0;
            z-index: 100;
            transition: transform 0.3s ease;
        }
        .nav-menu.mobile {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            top: auto;
            height: auto;
            width: 100%;
            flex-direction: row;
            justify-content: space-between;
            padding: 0.75rem 1rem;
            margin: 0;
            border-right: none;
            border-top: 1px solid #e5e7eb;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
        }
        .nav-item {
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0.5rem 0;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            color: #6b7280;
        }
        .nav-menu.mobile .nav-item {
            margin: 0;
            flex: 0 0 auto;
            width: 50px;
            height: 50px;
        }
        .nav-spacer {
            display: block;
        }
        .nav-menu.mobile .nav-spacer {
            display: none;
        }
        .logout-desktop {
            display: flex;
        }
        .logout-mobile {
            display: none;
        }
        .header-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .header-right {
            text-align: right;
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        @media (max-width: 768px) {
            .logout-desktop {
                display: none;
            }
            .logout-mobile {
                display: block;
            }
            .header-container {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }
            .header-right {
                align-self: flex-end;
                margin-top: 0.5rem;
            }
        }
        .nav-item.active {
            background: #000000;
            color: white;
        }
        .main-content {
            margin-left: 80px;
            padding: 2rem;
            width: calc(100% - 80px);
            min-height: 100vh;
        }
        @media (max-width: 768px) {
            .nav-menu {
                transform: translateX(-100%);
            }
            .nav-menu.mobile {
                transform: translateX(0);
            }
            .main-content {
                margin-left: 0;
                width: 100%;
                padding: 1rem;
                padding-bottom: 80px;
            }
        }
        .section {
            scroll-margin-top: 2rem;
        }
        .profile-header {
            text-align: center;
            padding: 3rem 0 2rem;
        }
        .profile-avatar {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            border: 3px solid #e5e7eb;
            margin: 0 auto 1.5rem;
            object-fit: cover;
        }
        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: #1f2937;
            margin-bottom: 2rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #e5e7eb;
        }
        .info-item {
            margin-bottom: 1.5rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid #f3f4f6;
        }
        .info-item:last-child {
            border-bottom: none;
        }
        .info-label {
            font-size: 0.875rem;
            color: #6b7280;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.25rem;
        }
        .info-value {
            font-size: 1rem;
            color: #1f2937;
            font-weight: 500;
        }
        .two-col {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }
        @media (max-width: 768px) {
            .two-col {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation Menu -->
    <nav class="nav-menu" id="navMenu">
        <a href="#profile" class="nav-item active" data-section="profile" title="Profile">
            <i class="fas fa-user text-xl"></i>
        </a>
        <a href="#personal" class="nav-item" data-section="personal" title="Personal Info">
            <i class="fas fa-user-circle text-xl"></i>
        </a>
        <a href="#contact" class="nav-item" data-section="contact" title="Contact">
            <i class="fas fa-address-book text-xl"></i>
        </a>
        <a href="#academic" class="nav-item" data-section="academic" title="Academic">
            <i class="fas fa-graduation-cap text-xl"></i>
        </a>
        <a href="#additional" class="nav-item" data-section="additional" title="Additional">
            <i class="fas fa-info-circle text-xl"></i>
        </a>
        <div class="nav-spacer" style="flex: 1;"></div>
        <a href="/logout" class="nav-item logout-desktop" title="Logout">
            <i class="fas fa-sign-out-alt text-xl"></i>
        </a>
    </nav>

    <!-- Main Content -->
    <div class="main-content">
        <!-- CHAKSHU Header -->
        <header class="mb-8 pb-6 border-b-2 border-gray-200">
            <div class="header-container">
                <div class="flex items-center space-x-4">
                    <i class="fas fa-user-graduate text-4xl text-gray-900"></i>
                    <div>
                        <h1 class="text-3xl font-extrabold text-gray-900">CHAKSHU</h1>
                        <p class="text-gray-600 text-sm italic">Not just an eye, a vision</p>
                    </div>
                </div>
                <div class="header-right">
                    <p class="text-gray-700">Welcome, <span class="font-semibold">{{ student.studentName }}</span></p>
                    <a href="/logout" class="logout-mobile text-gray-800 hover:text-gray-900 font-semibold transition duration-200" title="Logout">
                        <i class="fas fa-sign-out-alt text-xl"></i>
                    </a>
                </div>
            </div>
        </header>

        <!-- Profile Section -->
        <section id="profile" class="section">
            <div class="profile-header">
                {% set _resolved = resolve_profile_image_thumb(student.profileImage, student.rollNo) %}
                {% if _resolved %}
                <img src="{{ url_for('static', filename=_resolved) }}" 
                     alt="Profile" 
                     loading="lazy" decoding="async"
                     class="profile-avatar" width="150" height="150">
                {% else %}
                {% set _name = (student.studentName or '').strip() %}
                {% set _parts = _name.split() %}
                {% if _parts|length == 0 %}
                <img src="{{ url_for('static', filename='default.jpg') }}" alt="No Photo" loading="lazy" class="profile-avatar">
                {% else %}
                    {% if _parts|length == 1 %}
                        {% set _initials = (_parts[0][:2]).upper() %}
                    {% else %}
                        {% set _initials = (_parts[0][0] ~ _parts[-1][0]).upper() %}
                    {% endif %}
                    {% set theme = avatar_theme(_name) %}
                    <div class="profile-avatar mx-auto" style="
                        background: {{ theme.bg }};
                        color: {{ theme.fg }}; display:flex; align-items:center; justify-content:center;
                        font-weight:900; font-size:3rem; text-transform:uppercase;
                        border: 3px solid #e5e7eb;">
                        {{ _initials }}
                    </div>
                {% endif %}
                {% endif %}
                <h2 class="text-4xl font-bold text-gray-900 mt-4 mb-2">{{ student.studentName }}</h2>
                <p class="text-xl text-gray-600 uppercase">{{ student.programName or 'Student' }}</p>
            </div>
            <div class="two-col mt-8">
                <div class="info-item">
                    <div class="info-label"><i class="fas fa-id-card mr-2"></i>Roll No</div>
                    <div class="info-value">{{ student.rollNo }}</div>
                </div>
                {% if student.regNo %}
                <div class="info-item">
                    <div class="info-label"><i class="fas fa-certificate mr-2"></i>Reg No</div>
                    <div class="info-value">{{ student.regNo }}</div>
                </div>
                {% endif %}
                <div class="info-item">
                    <div class="info-label"><i class="fas fa-users mr-2"></i>Class</div>
                    <div class="info-value">{{ student.classSection }}</div>
                </div>
            </div>
        </section>

        <div class="section-divider"></div>

        <!-- Personal Information Section -->
        <section id="personal" class="section">
            <h3 class="section-title">Personal Information</h3>
            <div class="two-col">
                {% if student.fatherName %}
                <div class="info-item">
                    <div class="info-label"><i class="fas fa-male mr-2"></i>Father's Name</div>
                    <div class="info-value">{{ student.fatherName }}</div>
                </div>
                {% endif %}
                {% if student.gender %}
                <div class="info-item">
                    <div class="info-label"><i class="fas fa-venus-mars mr-2"></i>Gender</div>
                    <div class="info-value">{{ student.gender }}</div>
                </div>
                {% endif %}
                {% if student.dob %}
                <div class="info-item">
                    <div class="info-label"><i class="fas fa-birthday-cake mr-2"></i>Date of Birth</div>
                    <div class="info-value">{{ student.dob }}</div>
                </div>
                {% endif %}
                {% if student.bloodGroup %}
                <div class="info-item">
                    <div class="info-label"><i class="fas fa-tint mr-2" style="color:#dc2626;"></i>Blood Group</div>
                    <div class="info-value">{{ student.bloodGroup }}</div>
                </div>
                {% endif %}
                {% if student.category %}
                <div class="info-item">
                    <div class="info-label"><i class="fas fa-tag mr-2"></i>Category</div>
                    <div class="info-value">{{ student.category }}</div>
                </div>
                {% endif %}
                {% if student.religion %}
                <div class="info-item">
                    <div class="info-label"><i class="fas fa-place-of-worship mr-2"></i>Religion</div>
                    <div class="info-value">{{ student.religion }}</div>
                </div>
                {% endif %}
                {% if student.caste %}
                <div class="info-item">
                    <div class="info-label"><i class="fas fa-users mr-2"></i>Caste</div>
                    <div class="info-value">{{ student.caste }}</div>
                </div>
                {% endif %}
            </div>
        </section>

        <div class="section-divider"></div>

        <!-- Contact Information Section -->
        <section id="contact" class="section">
            <h3 class="section-title">Contact Information</h3>
            <div class="two-col">
                {% if student.email %}
                <div class="info-item">
                    <div class="info-label"><i class="fas fa-envelope mr-2"></i>Email</div>
                    <div class="info-value break-all">{{ student.email }}</div>
                </div>
                {% endif %}
                {% if student.studentContact %}
                <div class="info-item">
                    <div class="info-label"><i class="fas fa-phone mr-2"></i>Student Contact</div>
                    <div class="info-value">+91 {{ student.studentContact }}</div>
                </div>
                {% endif %}
                {% if student.parentNo %}
                <div class="info-item">
                    <div class="info-label"><i class="fas fa-user-friends mr-2"></i>Parent Contact</div>
                    <div class="info-value">+91 {{ student.parentNo }}</div>
                </div>
                {% endif %}
                {% if student.address %}
                <div class="info-item" style="grid-column: 1 / -1;">
                    <div class="info-label"><i class="fas fa-map-marker-alt mr-2"></i>Address</div>
                    <div class="info-value">{{ student.address }}</div>
                </div>
                {% endif %}
                {% if student.state %}
                <div class="info-item">
                    <div class="info-label"><i class="fas fa-map mr-2"></i>State</div>
                    <div class="info-value">{{ student.state }}</div>
                </div>
                {% endif %}
                {% if student.district %}
                <div class="info-item">
                    <div class="info-label"><i class="fas fa-map-pin mr-2"></i>District</div>
                    <div class="info-value">{{ student.district }}</div>
                </div>
                {% endif %}
            </div>
        </section>

        <div class="section-divider"></div>

        <!-- Academic Information Section -->
        <section id="academic" class="section">
            <h3 class="section-title">Academic Information</h3>
            <div class="two-col">
               
                {% if student.pucInstitute %}
                <div class="info-item" style="grid-column: 1 / -1;">
                    <div class="info-label"><i class="fas fa-school mr-2"></i>Previous Institute</div>
                    <div class="info-value">{{ student.pucInstitute }}</div>
                </div>
                {% endif %}
                {% if student.pucPercentage %}
                <div class="info-item">
                    <div class="info-label"><i class="fas fa-percentage mr-2"></i>PUC Percentage</div>
                    <div class="info-value">
                        {% set _pct = ("%.2f"|format((student.pucPercentage|string)|float)) %}
                        {% if _pct.endswith('00') %}{{ _pct[:-3] }}{% else %}{{ _pct }}{% endif %}%
                    </div>
                </div>
                {% endif %}
                {% if student.pucYear %}
                <div class="info-item">
                    <div class="info-label"><i class="fas fa-calendar mr-2"></i>PUC Year</div>
                    <div class="info-value">{{ student.pucYear }}</div>
                </div>
                {% endif %}
                {% if student.pucRollNo %}
                <div class="info-item">
                    <div class="info-label"><i class="fas fa-id-badge mr-2"></i>PUC Roll No</div>
                    <div class="info-value">{{ student.pucRollNo }}</div>
                </div>
                {% endif %}
                {% if student.pucTotalMarks %}
                <div class="info-item">
                    <div class="info-label"><i class="fas fa-chart-line mr-2"></i>PUC Total Marks</div>
                    <div class="info-value">{{ student.pucTotalMarks }}</div>
                </div>
                {% endif %}
                {% if student.pucObtainedMarks %}
                <div class="info-item">
                    <div class="info-label"><i class="fas fa-trophy mr-2"></i>PUC Obtained Marks</div>
                    <div class="info-value">{{ student.pucObtainedMarks }}</div>
                </div>
                {% endif %}
            </div>
        </section>

        {% if student.abcId or student.aadharNo or student.income or student.categoryApplied %}
        <div class="section-divider"></div>

        <!-- Additional Information Section -->
        <section id="additional" class="section">
            <h3 class="section-title">Additional Information</h3>
            <div class="two-col">
                {% if student.aadharNo %}
                <div class="info-item">
                    <div class="info-label"><i class="fas fa-id-card mr-2"></i>Aadhar No</div>
                    <div class="info-value">{{ student.aadharNo }}</div>
                </div>
                {% endif %}
                {% if student.abcId %}
                <div class="info-item">
                    <div class="info-label"><i class="fas fa-qrcode mr-2"></i>ABC ID</div>
                    <div class="info-value">{{ student.abcId }}</div>
                </div>
                {% endif %}
                {% if student.income %}
                <div class="info-item">
                    <div class="info-label"><i class="fas fa-rupee-sign mr-2"></i>Income</div>
                    <div class="info-value">{{ student.income }}</div>
                </div>
                {% endif %}
                {% if student.categoryApplied %}
                <div class="info-item">
                    <div class="info-label"><i class="fas fa-file-alt mr-2"></i>Category Applied</div>
                    <div class="info-value">{{ student.categoryApplied }}</div>
                </div>
                {% endif %}
            </div>
        </section>
        {% endif %}

        <!-- Footer -->
        <footer class="text-center text-gray-500 mt-12 mb-8">
            <p class="text-sm text-gray-900 font-bold">Â© 2025 CHAKSHU | Developed by Incubation Center | All Rights Reserved.</p>
        </footer>
    </div>

    <script>
        // Mobile menu detection
        function checkMobile() {
            const navMenu = document.getElementById('navMenu');
            if (window.innerWidth <= 768) {
                navMenu.classList.add('mobile');
            } else {
                navMenu.classList.remove('mobile');
            }
        }
        checkMobile();
        window.addEventListener('resize', checkMobile);

        // Smooth scroll and active menu item
        document.querySelectorAll('.nav-item[data-section]').forEach(item => {
            item.addEventListener('click', function(e) {
                e.preventDefault();
                const sectionId = this.getAttribute('data-section');
                const section = document.getElementById(sectionId);
                if (section) {
                    section.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    // Update active state
                    document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
                    this.classList.add('active');
                }
            });
        });

        // Update active menu on scroll
        const sections = document.querySelectorAll('.section');
        const navItems = document.querySelectorAll('.nav-item[data-section]');
        
        function updateActiveNav() {
            let current = '';
            let minDistance = Infinity;
            
            sections.forEach(section => {
                const sectionTop = section.offsetTop;
                const sectionHeight = section.clientHeight;
                const scrollPos = window.pageYOffset + 150; // Offset for better detection
                
                // Check if section is in viewport
                if (scrollPos >= sectionTop && scrollPos < sectionTop + sectionHeight) {
                    const distance = Math.abs(scrollPos - sectionTop);
                    if (distance < minDistance) {
                        minDistance = distance;
                        current = section.getAttribute('id');
                    }
                }
            });
            
            // If no section is in viewport, find the closest one
            if (!current) {
                sections.forEach(section => {
                    const sectionTop = section.offsetTop;
                    const scrollPos = window.pageYOffset + 150;
                    const distance = Math.abs(scrollPos - sectionTop);
                    if (distance < minDistance) {
                        minDistance = distance;
                        current = section.getAttribute('id');
                    }
                });
            }
            
            navItems.forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('data-section') === current) {
                    item.classList.add('active');
                }
            });
        }
        
        window.addEventListener('scroll', updateActiveNav);
        updateActiveNav();
    </script>
</body>
</html>
